This code is terrible.  Clean it up.
